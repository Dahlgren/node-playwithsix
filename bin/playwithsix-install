#!/usr/bin/env node

var program = require('commander');
var ProgressBar = require('progress');

var pws = require('../src/pws');

program
  .option('-p, --path [value]', 'path to directory if other than cwd')
  .parse(process.argv);

var mods = program.args;

if (!mods.length) {
  console.error("PlayWithSix installation requires at least one mod");
  process.exit(1);
}

if (!program.path) {
  program.path = process.cwd();
}

var currentMod = null;
var progressBar = null;

pws.downloadMods(program.path, mods, function(err, mods) {
  if (err) {
    console.error(err);
    process.exit(1);
  }
}).on('progress', function (progress) {
  if (progress.mod !== currentMod) {
    currentMod = progress.mod;
    if (progressBar !== null) {
      progressBar.terminate();
    }

    progressBar = new ProgressBar(' ' + progress.mod + ' [:bar] :percent', {
        clear: false
      , complete: '='
      , incomplete: ' '
      , width: 40
      , total: progress.size
    });
  }
  progressBar.update(progress.completed / progress.size);
});
